微支付项目com.ugc.micropayment：

原因及解决问题：

1. 以太坊链上交易需要花费gas手续费，对于小额交易来说，花费的gas所占交易金额比例过大，因此小额交易由此项目进行内部账户交易。

2. 作为无状态的服务，由其他webserver进行调用。

3. 提供充值，交易，提现服务。充值以及提现需要上链，需要从链上查询状态。转账为内部交易，此项目维护交易记录表。

主要功能点：

1. 给用户创建以太坊地址，存入account表；或者用户输入以太坊地址，此项目查询account是否有该地址，不存在则插入。

2. 用户通过此项目充值，实际上是向公司的以太坊地址充值，同时此项目查询链上充值状态，并在account表中更新amount(充值的钱)。

3. 用户通过此项目提现，需要证明该账户属于用户。即用户传入交易内容加密后hash的签名，地址，消息明文，此项目需要通过消息明文以及加密规则计算hash值，通过签名还原出地址。验证通过后从公司以太坊地址进行转账。

4. 用户通过此项目交易，同提现，需要用签名还原出地址。验证通过后转出账户amount减少，转入账户amount增加。

5. 提现转账均需要nonce值，避免双花的发生。即每次提现交易前先在account中取得nonce值，操作完成后nonce+1.如果nonce相差不是1则拒绝。

6. 交易及提现均需要验证转出账户的余额是否足够。

签名交易内容：

1. 验证签名需要用户在客户端用以太坊密钥对签名一个消息的hash，然后传给此项目 1.签名消息 2.地址 3.消息明文 4.nonce. 此项目通过消息明文，nonce计算hash，然后通过签名验证地址。

2. 加密规则：客户端使用web3.sha3(message,nonce,address)加密进行签名。nonce从服务端获取并+1.

3. 解密方式: 服务端使用消息明文,传入的nonce,address使用BouncyCastle进行sha3，然后验证地址是否一样。

项目使用：

1. springboot + mybatis

2. BouncyCastle.

